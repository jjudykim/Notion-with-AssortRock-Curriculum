# 24/06/18 - Editor ì œì‘(1)

ìƒìœ„ í•­ëª©: Week30 (Week30%204d14be1ecff547fa850e841a70655ecf.md)
ì£¼ì°¨: 0011_Week20~29

> 1êµì‹œ ë…¹ìŒë³¸
- [https://clovanote.naver.com/s/AjuidHGZNnnKw4NC7eezHTS](https://clovanote.naver.com/s/AjuidHGZNnnKw4NC7eezHTS)

2êµì‹œ ë…¹ìŒë³¸
- [https://clovanote.naver.com/s/YC6DhxDcmVRJztBmo6y7SHS](https://clovanote.naver.com/s/YC6DhxDcmVRJztBmo6y7SHS)
> 

## Editorì˜ ì‹œì‘

ê²Œì„ì„ ê°œë°œí•˜ëŠ”ë° í•„ìš”í•œ ì „ë°˜ì ì¸ ê¸°ëŠ¥ë“¤ê³¼ ê´€ë ¨ ë„êµ¬ë“¤ì€ Editorê°€ ë‹´ë‹¹í•˜ê²Œ ë  ê²ƒì´ë‹¤!

### Levelì— ìƒíƒœ ë¶€ì—¬í•˜ê¸° â†’ Play, Pause, Stop

ì´ì œë¶€í„´  Levelì´ Playì¤‘ì¸ ìƒíƒœì¸ì§€, ì •ì§€ ì¤‘ì¸ ìƒíƒœì¸ì§€ë¥¼ êµ¬ë³„í•´ì•¼ í•œë‹¤

â†’ ë”°ë¼ì„œ Levelì—ëŠ” ìƒíƒœ ê°œë…ì´ ìˆì–´ì•¼ í•¨

**LEVELì˜ ìƒíƒœë¥¼ enumìœ¼ë¡œ ì •ì˜í•˜ì**

```cpp
enum LEVEL_STATE
{
	PLAY,
	PAUSE,
	STOP,
};
```

ì´ì œ Levelì˜ ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•´ ë©¤ë²„ ë³€ìˆ˜/í•¨ìˆ˜ë¥¼ ì¶”ê°€í•´ì£¼ì

- í˜„ì¬ Levelì˜ LEVEL_STATEë¥¼ ë©¤ë²„ ë³€ìˆ˜ë¡œ ê°€ì§ â†’ `m_State`
- ë ˆë²¨ì˜ ìƒíƒœë¥¼ ë³€í™˜í•´ì£¼ëŠ” í•¨ìˆ˜ë¥¼ ë©¤ë²„ í•¨ìˆ˜ë¡œ ê°€ì§ â†’ `ChangeState()`
    
    â†’ ì´ë•Œ, ChangeStateëŠ” ì™¸ë¶€ì—ì„œ ë°”ë¡œ í˜¸ì¶œë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ TaskMgrë¥¼ í†µí•´ì„œ í˜¸ì¶œì´ ë˜ë„ë¡ êµ¬í˜„í•  ê²ƒì´ë‹¤
    

```cpp
// ...
class CLevel :
	public CEntity
{
private:
	CLayer*        m_Layer[MAX_LAYER];
	LEVEL_STATE    m_State;
	
public:
	// ...
	LEVEL_STATE GetState() { return m_State; }

private:
	// TaskMgrë¥¼ í†µí•´ì„œ ë ˆë²¨ì˜ ìƒíƒœ ë³€í™˜ì´ ì´ë£¨ì–´ì§€ë„ë¡ í•˜ê¸°
	void ChangeState(LEVEL_STATE _NextState);
	
	// ...
	friend class CTaskMgr;
};
```

```cpp
CLevel::CLevel()
	: m_Layer{}
	, m_State(LEVEL_STATE::STOP)                             // m_Stateì˜ ì´ˆê¸°ê°’ ì„¤ì •
{}

// ...

void CLevel::ChangeState(LEVEL_STATE _NextState)
{
	// ë³€í™˜í•˜ë ¤ëŠ” Levelì˜ ìƒíƒœê°€ í˜„ì¬ì™€ ë™ì¼í•  ê²½ìš° ë°”ë¡œ return
	if (m_State == _NextState)
		return;
	
	// Stateê°€ ë³€í•˜ëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ ìƒê°í•´ë³´ê¸°
	// 1) Stop -> Pause(X, ë¶ˆê°€ëŠ¥!)
	if (STOP == m_Satate && PAUSE == _NextState)
		return;
	
	// 2) Stop -> Play
	// ì •ì§€ ìƒíƒœì˜ Levelì´ ì‹œì‘ë˜ë©´, ëª¨ë“  Objectë“¤ì—ê²Œ Beginì´ í˜¸ì¶œë˜ì–´ì•¼ í•œë‹¤
	if (STOP == m_State && PLAY == _NextState)
	{
		Begin();
	}
	m_State = _NextState;
	 
	// 2) Play -> Stop
	// Levelì—ì„œ ë°œìƒí•œ ëª¨ë“  ì¼ë“¤ì´ ìµœì´ˆ ì‹œì ìœ¼ë¡œ ì´ˆê¸°í™” ë˜ì–´ì•¼ í•œë‹¤
	// ë”°ë¼ì„œ ê´€ë ¨ëœ ì •ë³´ê°€ ëª¨ë‘ ì €ì¥ë˜ì–´ ìˆì—ˆì–´ì•¼ í•œë‹¤
	// ì¦‰, ìµœì´ˆ ë ˆë²¨ì´ ì‹œì‘ë˜ë˜ ì‹œì ìœ¼ë¡œ ë³µêµ¬ê°€ ê°€ëŠ¥í•´ì•¼ í•œë‹¤
	// 
	//
	// 3) Play -> Pause 
	// 
	// 4) Pause -> Stop
}
```

â†’ ë‚˜ì¤‘ì— ì¶”ê°€ë¡œ ë” ë³´ì™„í•´ì„œ êµ¬í˜„í•  ê²ƒ! 

ì¼ë‹¨ Levelì´ ì‹œì‘í•˜ë˜ ì‹œì ì˜ ì •ë³´ê°€ ì €ì¥ë˜ì–´ìˆëŠ” ê¸°ëŠ¥ êµ¬í˜„ì´ í•„ìš”í•˜ë¯€ë¡œâ€¦

**Level State Changeì— ëŒ€í•œ Task ì •ì˜í•˜ê¸°**

ê°€ì¥ ë¨¼ì €, Task Typeì— Level Stateë¥¼ ì¶”ê°€í•´ì£¼ì

```cpp
enum TASK_TYPE
{
	// ...
	// Param_0 : Next Level State
	CHANGE_LEVEL_STATE,
	// ...
};
```

Task Managerë¥¼ í†µí•´ì„œ í˜„ì¬ ë ˆë²¨ì„ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜ì¸ `ChangeLevelState` (ì „ì—­ í•¨ìˆ˜)ëŠ” `func.h`ì— êµ¬í˜„í•´ ì–´ëŠ ì‹œì ì—ì„œë“  í˜¸ì¶œì´ ê°€ëŠ¥í•˜ë„ë¡ ì‘ì„±í•´ì£¼ì

```cpp
// ...
void ChangeLevelState(LEVEL_STATE _NextState);
// ...
```

```cpp
void ChangeLevelState(LEVEL_STATE _NextState)
{
	tTask task = {};
	task.Type = TASK_TYPE::CHANGE_LEVELSTATE;
	task.Param_0 = (DWORD_PTR)_NextState;
	
	CTastkMgr::GetInst()->AddTask(task);
}
```

Task Managerì—ì„œëŠ” Change Level Stateì˜ caseë¥¼ ì¶”ê°€í•´ì£¼ê³ , ë‚˜ë¨¸ì§€ Logicì—ì„œë„ Level Stateë¥¼ ê³ ë ¤í•  ì¼ì´ ìˆë‹¤ë©´ ì¡°ê±´ì„ ì¶”ê°€í•´ì£¼ì

```cpp
void CTaskMgr::ExecuteTask()
{
	for (size_t i = 0; i < m_vecTask.size(); ++i)
	{
		tTask& task = m_vecTask[i];
		switch(task.Type);
		{
		case TASK_TYPE::CREATE_OBJECT:
		{
			// ...
			if (pCurLevel->GetState() != STOP)
			{
				pObject->Begin();
			} 
		}
			break;
		// ...
		case TASK_TYPE::CHANGE_LEVELSTATE:
		{
			LEVEL_STATE NextState = (LEVEL_STATE)task.Param_0;
			CLevel* pCurLevel = CLevelMgr::GetInst()->GetCurrentLevel();
			pCurLevel->ChangeState(NextState);
		}
			break;
	}
}
```

ë˜ LevelMgrì˜ Progressì—ì„œ, Levelì˜ ìƒíƒœì— ë”°ë¼ì„œ Tickì´ ì ìš©ë˜ì§€ ì•Šë„ë¡ ë§‰ì

```cpp
void CLevelMgr::Progress()
{
	if (m_CurLevel->GetState() == LEVEL_STATE::PLAY)
	{
		m_CurLevel->Tick();
	}
	
	m_CurLevel->ClearObject();
	m_CurLevel->FinalTick();     // í–‰ë ¬ ê³„ì‚°ì´ë‚˜ ë Œë”ë§ì„ ìœ„í•´ Final Tickì€ í¬í•¨
}
```

Begin í•¨ìˆ˜ì˜ í˜¸ì¶œì€ â†’ Levelì´ ì‹œì‘ë˜ëŠ” ìˆœê°„ or Levelì— í•©ë¥˜ë˜ëŠ” ìˆœê°„ì— í˜¸ì¶œëœë‹¤

ì´ë¯¸ Levelì´ í•œì°¸ ì‹œì‘ëœ í›„ì— (Timeì´ ê½¤ ì§„í–‰ëœ í›„ì—), í•œ ë¬¼ì²´ê°€ í•©ë¥˜í•˜ê²Œ ëœë‹¤ë©´?

â†’ í•´ë‹¹ ì˜¤ë¸Œì íŠ¸ëŠ” ê·¸ ì‹œì ì— Beginì´ í˜¸ì¶œë˜ì–´ì•¼ í•œë‹¤

ë‹¨, Stopì¼ ë•Œì—ëŠ” í•´ë‹¹ Levelì´ ë‹¤ì‹œ Playë˜ëŠ” ìˆœê°„ ëª¨ë“  ì˜¤ë¸Œì íŠ¸ë“¤ì—ê²Œ Beginì´ ì ìš©ë  ê²ƒì´ê¸° ë•Œë¬¸ì— ì œì™¸í•´ì¤€ë‹¤

```cpp
if (pCurLevel->GetState() != STOP)
{
	pObject->Begin();	
}
```

Client í”„ë¡œì íŠ¸ ìª½ì— ìƒˆë¡œìš´ í•„í„°ë¥¼ ë§Œë“¤ì–´ì£¼ì

<aside>
ğŸ“ New Filter! 
`Client Project`
> Manager
    > 01. EditorMgr

</aside>

ê·¸ë¦¬ê³  Client ìª½ì—ì„œ ë¯¸ë¦¬ ì»´íŒŒì¼ëœ í—¤ë”ë¥¼ ì¶”ê°€í•´ì£¼ê¸° â†’ `pch.h`, `pch.cpp`

```cpp
#pragma once

#ifdef _DEBUG
#pragma comment(lib, "Engine\\Engine_D")
#else
#pragma comment(lib, "Engine\\Engine")
#endif

#include <Engine/global.h>
#include <Engine/CEngine.h>
```

â†’ Client/`main.cpp`ì— `pch.h` ì¶”ê°€ (#include â€œpch.hâ€)

Game Editor ê´€ë ¨ëœ ê¸°ëŠ¥ì„ ì „ë°˜ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” Manager 

**CEditrMgr í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•´ë³´ì**

```cpp
#include <Engine/singleton.h>

class CEditorMgr:
	public CSingleton<CEditorMgr>	
{
	SINGLE(CEditorMgr);	
private:

public:
	void Init();
	void Tick();
};
```

### Levelì˜ Stopê³¼ Delta Timeì˜ ì²˜ë¦¬

Stop ìƒíƒœì¸ Levelë“¤ì˜ ì˜¤ë¸Œì íŠ¸ë“¤ì€ DTê°€ 0ì´ì–´ì•¼ í•œë‹¤. Levelì´ Stop ë˜ì–´ ìˆëŠ” ë™ì•ˆ, ì‹œê°„ì´ íë¥´ì§€ ì•Šê³  ì˜¤ë¸Œì íŠ¸ë“¤ì´ ë©ˆì¶°ìˆì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì—!

ê·¸ëŸ°ë° ì‹œê°„ì— ë”°ë¼ì„œ ì‘ì—…ì´ ìˆ˜í–‰ë˜ì•¼ í•˜ëŠ” Level ì™¸ì˜ ì‘ì—…ë“¤ì€?

â†’ ë”°ë¼ì„œ ì—”ì§„ ì°¨ì›ì˜ DTì™€ ê²Œì„ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” DTë¥¼ ë¶„ë¦¬í•´ì„œ ìƒê°í•´ì•¼ í•œë‹¤

TimeManagerì—ì„œ ì—”ì§„ìš© / ê²Œì„ìš©ì˜ ì‹œê°„ì„ ë‚˜ëˆ ë‘ì

```cpp
	float m_E_DeltaTime;
	float m_E_Time;

public:
	float GetDeltaTime() { return m_DeltaTime; }
	float GetTime() { return m_Time; } 

	float GetEngineDeltaTime()
	float GetEngineTime()
```

ê·¸ëŸ¼ ì‹œê°„ì„ ì—°ì‚°í•˜ëŠ” ê³¼ì •ë„ ì¡°ê¸ˆ ë‹¬ë¼ì ¸ì•¼ í•˜ê²Ÿì§€,,

```cpp
if (1.f / 60.f < m_E_DeltaTime)
{
	
}

m_llPrevCount = m_llCurCount;

++m_FPS;

static float AccTime = 0.f;
AccTime += m_E_DeltaTime;

if (1.f < AccTime)

	// Game Logicì— ì‚¬ìš©í•˜ëŠ” Levelìš© DTë¥¼ ë”°ë¡œ ì œì‘
	CLevel* pCurLevel = CLevelMgr::GetInst()->GetCurrentLevel();
	if (pCurLevel == nullptr || pCurLevel->GetState() != LEVEL_STATE::PLAY)
	{
		m_DeltaTime = 0.f;
	}
	else
	{
		m_DeltaTime = m_E_DeltaTime;
	}

	m_Time += m_DeltaTime;
};
```

ì—”ì§„ ì „ìš© DTë„ ë§¤í¬ë¡œë¡œ ì¶”ê°€í•´ì£¼ê¸°

```cpp
#define EngineDT CTimeMgr::GetInst()->GetEngineDeltaTime()
```

ë””ë²„ê·¸ ë Œë”ë§ì˜ DT ì—­ì‹œ ìˆ˜ì •í•´ì¤˜ì•¼ í•œë‹¤! â†’ Engine DTë¡œ

Free Cameraê°€ í•„ìš”í•œ ì‹œì !

Stop ìƒí™©ì—ì„œ ì˜¤ë¸Œì íŠ¸ë¥¼ ë°°ì¹˜í•˜ê³  í™”ë©´ì„ êµ¬ì„±í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•œë°, í˜„ì¬ëŠ” Level ì•ˆì— ì¡´ì¬í•˜ëŠ” Cameraë§Œ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì—, ë³„ë„ë¡œ ê´€ì°°ì ì‹œì ì˜ Free Cameraê°€ í•„ìš”í•˜ë‹¤!

Free Cameraì˜ ì—­í• ì„ í•˜ëŠ” GameObjectì¸ë°, Level ì™¸ì ìœ¼ë¡œ í™œìš©ì„ í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤

ë”°ë¼ì„œ Editor Mgrì—ì„œëŠ” ë ˆë²¨ ì™¸ì—ì„œ ì¡´ì¬í•˜ëŠ” GameObjectë“¤ì„ ê´€ë¦¬í•´ì¤„ ê²ƒì´ë‹¤!

```cpp
private:
	vector<CGameObject*> m_vecEditorObject;

public:
	void 
```

```cpp
#include 
#include <Engine/components.h>

void CEditorMgr::Init()
{
	CreateEditorObject();
}

void CEditorMgr::Tick()
{
	for (size_t i = 0; i < m_vecEditorObject.size(); ++i)
	{
		m_vecEditorObject[i]->Tick();
	}
	
	for (size_t i = 0; i < m_vecEditorObject.size(); ++i)
	{
		m_vecEditorObject[i]->FinalTick();
	}
}

void CEditorMgr::CreateEditorObject()
{
	CGameObject* pEditorCamera = new CGameObject;
	
	pEditorCamera->AddComponent(new CTransform);
	pEditorCamera->AddComponent(new CCamera);
	
	m_vecEditorObject.push_back(
}
```

Editor Camera ì „ìš©ì˜ Camera Script ì—­ì‹œ ì œì‘í•´ì¤„ ê²ƒì´ë‹¤

```cpp

```

í•´ë‹¹ ì¹´ë©”ë¼ì˜ ë‚´ìš©ì´ ì¶œë ¥ë  ìˆ˜ ìˆë„ë¡ Render Managerì— Editor Cameraë¥¼ ì¶”ê°€í•˜ê³  ë“±ë¡í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„

```cpp
void RegisterEditorCamera(CCamera* _Cam) { m_EditorCamera = _Cam; }
```

```cpp
void CLevelMgr:::Tick()
{
	CLevel* pCurLevel = CLevelMgr::GetInst()->GetCurrentLevel();
	
	if (pCurLevel == nullptr)
		return;
	
	// Levelì´ Play ìƒíƒœì¸ ê²½ìš°, Level ë‚´ì— ìˆëŠ” ì¹´ë©”ë¼ ì‹œì ìœ¼ë¡œ ë Œë”ë§ì„ ì§„í–‰	
	if (pCurLevel->GetState() == PLAY)
	{
		for (size_t i = 0; i < m_vecCam.size(); ++i)
		// ...
	}
	// Levelì´ Stopì´ë‚˜ Pauseì¸ ê²½ìš°, Editorìš© ì¹´ë©”ë¼ ì‹œì ìœ¼ë¡œ ë Œë”ë§ì„ ì§„í–‰
	else
	{
		if (m_EditorCamera != nullptr)
		{
			m_EditorCamera->Render();
		}
	}
}
```

ê·¸ëŸ¼ EditorManagerì—ì„œ ë§Œë“  EditorCameraë¥¼ ìƒì„±í•˜ëŠ” ì‹œì ì—ì„œ, Render Managerì— ë“±ë¡í•´ì¤€ë‹¤

```cpp

```

Clientì˜ mainì—ì„œ Editor Managerì˜ Progressë„ ëŒì•„ê°ˆ ìˆ˜ ìˆë„ë¡ ì¶”ê°€í•´ì¤„ ê²ƒì´ë‹¤!

1) Engineì„ ì´ˆê¸°í™”í•œ í›„, Editor Managerë„ ì´ˆê¸°í™”í•´ì£¼ê³ 

2) Engineì˜ Progessê°€ ì‹¤í–‰ëœ í›„ì—, Editor Managerì˜ Tickì´ ì‹¤í–‰ë˜ë„ë¡ ì¶”ê°€í•´ì£¼ì

```cpp
// CEngine ê°ì²´ ì´ˆê¸°í™”

// Editor Manager ì´ˆê¸°í™”
```

ê·¸ëŸ°ë° ìš°ë¦¬ê°€ ì „ì— GameObjectì˜ FinalTickì—ì„œëŠ” Layerì— ì¡´ì¬í•˜ê³  ìˆì§€ ì•Šì€, ì¦‰ Levelì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ” Objectë“¤ì— ëŒ€í•´ì„œëŠ” ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ í•´ì£¼ì—ˆì—ˆë‹¤!

ë”°ë¼ì„œ ê¸°ì¡´ GameObjectë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šê³ , Editorìš©ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ GameObjectë¥¼ ì œì‘í•´ì¤„ ê²ƒì´ë‹¤ (Extention í™œìš©)

ë‚˜ë¨¸ì§€ëŠ” ë¶€ëª¨ì˜ ì†ì„±ì„ ëª¨ë‘ í™œìš©í•˜ë„ë¡ í•˜ê³ , ë¬¸ì œê°€ ë˜ëŠ” FinalTickë§Œ ë”°ë¡œ ì‘ì„±í•´ì„œ Editorìš©ìœ¼ë¡œ ì œì‘í•œ GameObjectë“¤ì€ í•´ë‹¹ ì˜ˆì™¸ì— ê±¸ë¦¬ì§€ ì•Šë„ë¡ êµ¬í˜„í•´ì£¼ì

```cpp
void CGameObjectEx::FinalTick()
{
	for (UINT i = 0; i < (UINT)COMPONENT_TYPE::END; ++i)
	{
		
	}
}
```

ì´ì œ ìš°ë¦¬ê°€ Editor Managerì—ì„œ ì œì‘í–ˆë˜ GameObjectë“¤ì€, CGameObjectExë¥¼ í™œìš©í•´ì„œ ë§Œë“¤ì–´ì£¼ì

Editor Cameraì—ê²Œë„ Scriptë¥¼ ì¶”ê°€í•´ì£¼ê¸°

â†’ CEditorCameraScript

```cpp
#include <Engine/CScript.h>

class CEditorCameraScript :
	public CScript
{
private: 
	float m_Speed;

public:
	virtual void Tick() override;
	
public:
	CLONE(CEditorCameraScript);
	CEditorCameraScript();
	~CEditorCameraScript();
}
```

```cpp
CEditorCameraScript::CEditorCameraScript()
	: m_Speed(500.f)
{
}

CEditorCameraScript::~CEditorCameraScript()
{
}

void CEditorCameraScript::Tick()
{
	// Move Camera Scriptì™€ ë™ì¼í•˜ê²Œ.. DT -> Engine DTë¡œ ë³€ê²½í•´ì„œ
	if (KEY_PRESSED(KEY::W))
	{
		
	}
}
```