# 2024/07/09 -

ìƒìœ„ í•­ëª©: Week33 (https://www.notion.so/Week33-c25c856dcd954fe0af5f24db92f6af83?pvs=21)
ìƒíƒœ: ë©”ëª¨
ì£¼ì°¨: 0100_Week30~39

> 1êµì‹œ ë…¹ìŒë³¸ -

2êµì‹œ ë…¹ìŒë³¸ -
> 

### Drag & Dropìœ¼ë¡œ ê³„ì¸µ ê´€ê³„ ê°±ì‹ í•˜ê¸° (2) - ê³„ì¸µ ê´€ê³„ íƒˆì¶œ

ìì‹ìœ¼ë¡œ í¬í•¨ë˜ì–´ ìˆëŠ” ë…¸ë“œê°€ ìì‹ ì˜ ë¶€ëª¨ ë…¸ë“œì˜ Tree êµ¬ì¡° ë‚´ì—ì„œ ë°”ê¹¥ìœ¼ë¡œ, ì¦‰ ì•„ë¬´ê²ƒë„ ì—†ëŠ” ê³³ìœ¼ë¡œ Drag & Drop ëœë‹¤ë©´? 

â†’ í•´ë‹¹ ìì‹ ë…¸ë“œì˜ ê³„ì¸µ êµ¬ì¡°ê°€ ëª¨ë‘ í•´ì œë˜ê³  í•´ë‹¹ ë…¸ë“œê°€ ìµœìƒìœ„ ë¶€ëª¨ ë…¸ë“œê°€ ë˜ê²Œë” ê°±ì‹ ë˜ë„ë¡ ê²½ìš°ì˜ ìˆ˜ë¥¼ ì¶”ê°€í•´ë³´ì

ê·¸ë ‡ë‹¤ë©´ ì´ëŠ” ì¦‰, Dragëœ í›„ - Drop Check ì‹œì— *Dropëœ ë…¸ë“œê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°*ì´ë¯€ë¡œ í•´ë‹¹ ê²½ìš°ì— ëŒ€í•œ ë¶„ê¸°ë¥¼ ì„¤ì •í•´ì£¼ì

```cpp
if (ImGui::IsMouseReleased(ImGuiMouseButton_Left))
{
	// ë“œë˜ê·¸í•œ ë…¸ë“œëŠ” ì¡´ì¬í•˜ì§€ë§Œ, ë°›ëŠ” ë…¸ë“œê°€ X
	if (m_DragedNode && ! m_DroppedNode)    
	{
		if (m_SelfDragDropInst && m_SelfDragDropFunc)
		{
			(m_Self
		}
	} 
}
```

ë‚´ë¶€ì—ì„œ ë°”ê¹¥ìœ¼ë¡œ, ì¦‰ ì•„ë¬´ê²ƒë„ ì—†ëŠ” ê³³ì— Drag & Dropì˜ ê²½ìš°ê°€ ë°˜ì˜ë  ìˆ˜ ìˆë„ë¡ ê²½ìš°ì˜ ìˆ˜ë¥¼ ì¶”ê°€

í—ˆê³µì˜ Drop ì²´í¬? ë§ˆìš°ìŠ¤ê°€ ë¦´ë¦¬ì¦ˆ ëì„ ë•Œ ë“œëëœ ë…¸ë“œ (m_DroppedNode)ë¥¼  nullptrë¡œ ë¹„ì›Œë²„ë¦¬ëŠ”ë°.. ì´ì „ì— ë“œëëœ ë…¸ë“œ ìì²´ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´?

```cpp
void Outliner::GameObjectAddChild(DWORD_PTR _Param1, DWORD_PTR _Param2)
{
	TreeNode* pDragNode = (TreeNode*)_Param1;
	TreeNode* pDropNode = (TreeNode*)_Param2;
	
	CGameObject* pDragObject = (CGameObject*)pDragNode->GetData();
	CGameObject* pDropObject = nullptr;
	
	if()
	{
		pDropObject = (CGameObject*)pDropNode->GetData();
		pDropObject->AddChild(pDragObject);
	}
	// Drop ëª©ì ì§€ê°€ ì—†ê¸° ë•Œë¬¸ì—, ê³„ì¸µê´€ê³„ íƒˆì¶œì˜ ì˜ë„ë¡œ ë³´ê³ 
	// Drag ì˜¤ë¸Œì íŠ¸ë¥¼ ìµœìƒìœ„ ë¶€ëª¨ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤
	else
	{
		if (!pDragObject->GetParent())
			return;
			
		pDragObject->DeregisterChild();
		
		// í˜„ì¬ Dragí•˜ëŠ” Nodeì— í•´ë‹¹í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ê°€
		// ìµœìƒìœ„ ë¶€ëª¨ê°€ ë˜ì—ˆê¸° ë•Œë¬¸ì—, í•´ë‹¹ Level Managerê°€ ê´€ë¦¬í•˜ëŠ” Layerì˜ ì†Œì†ìœ¼ë¡œ í¬í•¨
		// ë‹¨, ì´ë¯¸ ë³¸ì¸ì´ ì†Œì†í•˜ê³  ìˆë˜ Layerê°€ ìˆì—ˆìœ¼ë¯€ë¡œ ì¬ë“±ë¡í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ë‹¤
		CLevelMgr::GetInst()->GetCurrentLevel()->RegisterAsParent(pDragObject->GetLayerIdx(), pDragObject);
	}
}
```

ì›ë˜ëŠ” ì´ Levelì˜ ì†Œì†ì´ì§€ë§Œ, ê³„ì¸µ êµ¬ì¡°ê°€ ë³€ê²½ë˜ë©´ì„œ ì¬ë“±ë¡í•´ì•¼ í•˜ëŠ” ìƒí™©ì¼ ê²½ìš°ì— í˜¸ì¶œí•˜ê¸° ìš©ì´í•œ í•¨ìˆ˜ë¥¼ ìƒˆë¡­ê²Œ ì‘ì„±í•˜ì

```cpp
{
public:
	void RegisterAsParent(int LayerIdx, CGameObject* _Object);
}

```

```cpp
void CLevel::RegisterAsParent(int LayerIdx, CGameObject* _Object)
{
	m_Layer[LayerIdx]->RegisterAsParent(_Object);
}
```

```cpp
void CLayer::RegisterAsParent(CGameObject* _Object)
{
	// 1) í˜„ì¬ Layer ì†Œì†ì˜ Objectê°€ ë§ëŠ”ì§€ í™•ì¸
	// 2) Objectê°€ ìµœìƒìœ„ ë¶€ëª¨ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸
	assert(_Object->GetLayerIdx() == m_LayerIdx
					&& !_Object->GetParent());
					
	m_Parents.push_back(_Object);
	return;
}
```

### Tree UIë¡œ ê³„ì¸µ ê´€ê³„ë¥¼ ì¬ì •ë¦½ í•  ë•Œ, ë¶€ëª¨ê°€ ìì‹ ë…¸ë“œì˜ ìì‹ì´ ë  ìˆ˜ ì—†ë„ë¡ ë§‰ì•„ì£¼ê¸°

```cpp
bool IsAncestor();           // ë„ˆ ë‚´ ì¡°ìƒì´ë‹ˆ..?
```

```cpp
bool CGameObject::IsAncestor(CGameObject* _Object)
{
	CGameObject* pObject = m_Parent;
	
	while(pObject)
	{
		if (pObject == _Object)
			return true;
		else 
			pObject = pObject->GetParent();
	}
	
	return false;
}
```

Drag Drop ì‹œì— íŒë‹¨

```cpp
if (pDropNode)
{
		pDropObject = (CGameObject*)
}
else
{
}
```

## Post Process (í›„ì²˜ë¦¬)

ëª¨ë“  ë Œë”ë§ì´ ë‹¤ ëë‚˜ê³  ë‚œ ë’¤ì— ì²˜ë¦¬ë˜ëŠ” ì‘ì—…

ìƒˆë¡œìš´ ì˜¤ë¸Œì íŠ¸ê°€ ë Œë”ë§ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë§ˆë¬´ë¦¬ ì‘ì—…, ë¦¬í„°ì¹­ê°™ì€?

ê·¸ëŸ¼ ë Œë”ë§ íŒŒì´í”„ë¼ì¸ì„ í†µí•´ ì´ ì‘ì—…ì„ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆì„ì§€..?

Render Managerì—ì„œ PostProcess ìš©ë„ì˜ í…ìŠ¤ì³ë¥¼ í•˜ë‚˜ ìƒì„±

```cpp
CRenderMgr
{
	Ptr<CTexture>    m_PostProcessTex;
}
```

```cpp
void CAssetMgr::CreateEngineTexture()
{
	Vec2 Resolution = CDevice::

	// PostProcess ìš©ë„ í…ìŠ¤ì³ ìƒì„±
	m_PostProcessTex = CAssetMgr::GetInst()->CreateTexture(L"PostProcessTexture"
	, (UINT)Resolution.x, (UINT)Resolution.y
	, DXGI_FORMAT_R8G8B8A8_UNORM, D3D11_BIND_SHADER_RESOURCE);
}
```

```cpp
void CAssetMgr::Init()
{
	// Asset Managerê°€ ì´ˆê¸°í™”ë  ë•Œ ë§Œë“¤ì–´ë†“ì€, Post Processìš© í…ìŠ¤ì³ë¥¼ ì°¸ì¡°
	m_PostProcessTex = CAssetMgr::GetInst()->FindAsset<CTexture>(L"PostProcessTex");	
}
```

- í•´ìƒë„ëŠ” ë°˜ë“œì‹œ í˜„ì¬ Render Target Textureì™€ ë™ì¼í•´ì•¼ í•¨
- 

<aside>
ğŸ—’ï¸ [ì¶”ê°€ ì‚¬í•­]
Bind Flag ì¡°í•©ì— ëŒ€í•œ ì´ì•¼ê¸°

</aside>

ë³µì‚¬ â†’ í›„ì²˜ë¦¬ â†’ ë Œë”ë§ í•˜ëŠ” ì¼ë ¨ì˜ ê³¼ì •ì— ëŒ€í•´ì„œ ì •ë¦¬í•´ë³´ê¸°

```cpp
enum SHADER_DOMAIN
{
	// ...
	DOMAIN_POSTPROCESS,         // "í›„ì²˜ë¦¬ ë‹¨ê³„" ì¶”ê°€
	
	DOMAIN_DEBUG,
}
```

â†’ ë Œë”ë§ íŒŒì´í”„ë¼ì¸ ìƒì—ì„œ ì‚¬ìš©ë˜ëŠ” ì‰ì´ë” ì¤‘, ë¬´ì¡°ê±´ ê°€ì¥ ë§ˆì§€ë§‰ ìˆœì„œì— í˜¸ì¶œ

Render Managerì—ì„œ Copyí•˜ëŠ” í•¨ìˆ˜ ì œì‘

```cpp
CRenderMgr
{
	void PostProcessCopy();
}
```

```cpp
void CRenderMgr::PostProcessCopy()
{
	// RenderTarget -> PostProcessTex
	CONTEXT->CopyResource(m_PostProcessTex->GetTex2D().Get(), pRTTex->GetTex2D().Get());
}
```

- `CopyResource()` í•¨ìˆ˜ì— ëŒ€í•˜ì—¬

```cpp
pShader = new CGraphicShader;

pShader->CreateVertexShader(L"shader\\postprocess.fx", "VS_GrayFilter");
pShader->CreatePixelShader(L"shader\\postprocess.fx", "PS_GrayFilter");

pShader->SetRSType(RS_TYPE::CULL_NONE);
pShader->SetDSType(DS_TYPE::NO_TEST_NO_WRITE);
pShader->SetBSType(BS_TYPE::DEFAULT);

pShader->SetDomain(SHADER_DOMAIN::DOMAIN_POSTPROCESS);

```

GrayFilter Shader ì „ìš© ì¬ì§ˆ ìƒì„±

```cpp
pMtrl = new CMaterial();
pMtrl->SetShader(FindAsset<CGraphicShader>(L"GrayFilterShader"));
pMtrl->SetTexParam(TEX_0, FindAsset<CTexture>

```

Post Process ì „ìš© ì˜¤ë¸Œì íŠ¸ ìƒì„±

```cpp
CGameObject* pGrayFilterObj = new CGameObject;
pGrayFilterObj->AddComponent(new CTransform);
pGrayFilterObj->AddComponent(new CMeshRender);

pGrayFilterObj->MeshRender()->SetMesh(CAssetMgr::GetInst()->FindAsset<CMesh>(L"RectMesh"));
pGrayFilterObj->MeshRender()->SetMaterial(CAssetMgr::GetInst()->FindAsset<CMaterial>(L"GrayFilterMtrl"));

m_CurLevel->
```

- Transform Component ì¶”ê°€ â†’ ë³¸ì¸ì˜ Transformì— ìƒê´€ ì—†ì´ í•´ë‹¹ êµ¬ì—­ì— í•œì •ë˜ì§€ ì•Šê³ , í™”ë©´ ì „ì²´ì— ì ìš©
- MeshRender Component ì¶”ê°€ â†’

Post Process ë Œë”ë§ì€ ê°€ì¥ ë§ˆì§€ë§‰ ë‹¨ê³„ì— ì¼ì–´ë‚˜ë„ë¡..

```cpp
for (size_t i = -; i < m_vecPostProcess.size(); ++i)
{
	CRenderMgr::GetInst()->PostProcessCopy();
	m_vecPostProcess[i]->Render();
}
```

Post Processì˜ HLSL íŒŒì¼ ì‘ì„±

```cpp
#ifndef _POSTPROCESS
#define POSTPROCESS

// =======================
//    GrayFilterShader
// =======================

struct VS_IN
{
	float3 vPos : POSITION;
	float2 vUV : TEXCOORD;
};

struct VS_OUT
{
	float4 vPosition : SV_Position;
	float2 vUV : TEXCOORD;
};

VS_OUT VS_GrayFilter(VS_IN _in)
{
	VS_OUT output = (VS_OUT) 0.f;
	
	output.vPosition = float4(_in.vPos.xy * 2.f, 0.f, 1.f);
	output.vUV = _in.vUV;
	
	return output;
}

float4 PS_GrayFilter(VS_OUT _in) : SV_Target
{
	float4 vColor = g_tex_0.Sample(g_sam_0, _in.vUV);
	float Average = (vColor.x + vColor.y + vColor.z) / 3.f
	vColor = float4(Average, Average, Average, 1.f);
	
	return vColor;
}

#endif
```

â†’ ì‰ì´ë”ì½”ë“œ ë¶„ì„í•´ë³´