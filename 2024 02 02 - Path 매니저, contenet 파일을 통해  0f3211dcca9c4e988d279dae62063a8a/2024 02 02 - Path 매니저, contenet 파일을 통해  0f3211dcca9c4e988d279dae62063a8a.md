# 2024/02/02 - Path ë§¤ë‹ˆì €, contenet íŒŒì¼ì„ í†µí•´ Asset ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ê¸°

íƒœê·¸: C++, WinAPI, ì¤‘ê¸‰
ìƒìœ„ í•­ëª©: Week10 (Week10%206c3606b897d340fcb90a1dfe2956c91a.md)
ì£¼ì°¨: 0010_Week10~19

## ê²½ë¡œë¥¼ ë¬¸ìì—´ë¡œ ì €ì¥í•˜ê¸° ìœ„í•œ ì‘ì—…ë“¤

### Path ë§¤ë‹ˆì € ìƒì„± (ê²½ë¡œ ë§¤ë‹ˆì €)

```cpp
#pragma once

class CPathMgr
{
	SINGLE(CpathMgr);
private:
	wchar_t m_ContentPath[256];

public:
	void init();
}
```

- `m_ContentPath[256]` : Content ë””ë ‰í„°ë¦¬ê¹Œì§€ì˜ ê²½ë¡œë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë¬¸ìë¥¼ ë‹´ìœ¼ë ¤ëŠ” ë°°ì—´
    
    â†’ Windowì—ì„œëŠ” ê²½ë¡œë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë¬¸ìì—´ì˜ ê¸¸ì´ë¥¼ 255ë¡œ ì œí•œí•´ë‘ê³  ìˆìŒ! + nullë¬¸ìê¹Œì§€í•´ì„œ 256ê°œ
    

```cpp
#include "pch.h"
#include "CPathMgr.h"

CPathMgr::CPathMgr()
	: m_ContentPath{}
{}

CPathMgr::~CPathMgr()
{}

CPathMgr::init()
{
	// ì‹¤í–‰ ê²½ë¡œë¥¼ ì–»ì–´ë‚¸ë‹¤
	GetCurrentDirectory(256, m_ContentPath);	     // Windowì— ì •ì˜ëœ í•¨ìˆ˜ ë§¤í¬ë¡œ
}
```

- `GetCurrentDirectory()`
    
    : í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì˜ í˜„ì¬ ë””ë ‰í„°ë¦¬ ê²½ë¡œë¥¼ ì–»ì–´ë‚´ëŠ” í•¨ìˆ˜ë¡œ, Windowì— ì •ì˜ëœ í•¨ìˆ˜ ë§¤í¬ë¡œë¡œ ì •ì˜ë˜ì–´ ìˆë‹¤!
    
    **GetcurrentDirectory() í•¨ìˆ˜ì˜ ì›í˜•**
    
    ```cpp
    DWORD GetCurrentDirectory(
      [in]  DWORD  nBufferLength,   // í˜„ì¬ ë””ë ‰í„°ë¦¬ ê²½ë¡œì— ëŒ€í•œ ë¬¸ìì—´ì„ ë‹´ì„ ìˆ˜ ìˆëŠ” ë²„í¼ ê¸¸ì´
      [out] LPTSTR lpBuffer         // í˜„ì¬ ë””ë ‰í„°ë¦¬ ê²½ë¡œì— ëŒ€í•œ ë¬¸ìì—´ì„ ì €ì¥í•  ë²„í¼ í¬ì¸í„°
    );
    ```
    
    - ë§¤í¬ë¡œ ë‚´ì—ì„œëŠ” í˜„ì¬ í”„ë¡œì íŠ¸ì˜ ë¬¸ì í˜•ì‹ì´ UNICODEë¼ë©´ `GetCurrentDirectoryW`ê°€, ì•„ë‹ˆë¼ë©´ `GetCurrentDirectoryA`ê°€ ì‹¤í–‰ëœë‹¤
    - ë‘ë²ˆì§¸ ì¸ìë¡œ ë“¤ì–´ê°„ `LPTSTR`ì€ ë‚´ë¶€ì ìœ¼ë¡œ ì •ì˜ëœ â€œWCHARì˜ í¬ì¸í„° íƒ€ì…â€ìœ¼ë¡œ,
        
        â†’ ê²°ê³¼ì ìœ¼ë¡œëŠ” *wchar_tì˜ í¬ì¸í„° íƒ€ì…*ì„ ê°„ë‹¨í•˜ê²Œ ë‚˜íƒ€ë‚´ëŠ” ì…ˆì´ë‹¤
        

**í™”ë©´ì— ê·¸ë¦¬ê¸° ìœ„í•œ render êµ¬í˜„**

```cpp
void CpathMgr::render()
{
	TextOut(DC, 10, 10, m_ContentPath, wcslen(m_ContentPath));
}
```

**Debug ëª¨ë“œì—ì„œì˜ ê²½ë¡œ ì¡°ì •**

í˜„ì¬ëŠ” Debug ëª¨ë“œë¡œ ì‹¤í–‰ì‹œì¼°ì„ ë•Œ ì¶œë ¥ë˜ëŠ” ê²½ë¡œì™€, ì‹¤í–‰íŒŒì¼(.exe)ë¡œ ì¶œë ¥ë˜ëŠ” ê²½ë¡œê°€ ë‹¤ë¥´ë‹¤

ë””ë²„ê¹… ëª¨ë“œë¡œ ì‹¤í–‰í•˜ë”ë¼ë„ ê²½ë¡œë¥¼ ë‹¤ë¥¸ ê³³(OutputFile ìª½)ìœ¼ë¡œ ì„¤ì •í•´ì£¼ê³  ì‹¶ë‹¤ë©´

í”„ë¡œì íŠ¸ > ì†ì„± > ë””ë²„ê¹… > ì‘ì—… ë””ë ‰í„°ë¦¬ (ìš°ë¦¬ê°€ í˜„ì¬ ì‘ì—…í•˜ê³  ìˆëŠ” ë””ë ‰í„°ë¦¬ì´ë‹ˆ..)

<aside>
ğŸ“ $(SolutionDir)OutputFile\bin\

</aside>

### ë°›ì•„ì˜¬ ê²½ë¡œ ë¬¸ìì—´ë“¤ì„ ì¶”ê°€í•´ë³´ì ( + ì†”ë£¨ì…˜ dir, í”„ë¡œì íŠ¸ dir)

```cpp
class CPathMgr
{
	SINGLE(CPathMgr);
private:	
	// ê²½ë¡œ ë¬¸ìì—´ë“¤ ì¶”ê°€
	wstring m_ContentDir;
	wstring m_SolutionDir;
	wstring m_ProjDir;

// ...
public:
	const wchar_t* GetContentPath() { return m_ContentDir };
	const wchar_t* GetSoultionPath() { return m_SolutionDir };
	const wchar_t* GetProjectPath() { return m_ProjDir };
```

â†’ í•´ë‹¹ ê²½ë¡œë“¤ì€ ì¤‘ê°„ì— ìˆ˜ì •ë˜ë©´ ì•ˆë˜ë¯€ë¡œ, `Get` í•¨ìˆ˜ëŠ” constë¡œ ì „ë‹¬ë˜ì–´ì•¼ í•œë‹¤

ë‹¤ìŒ Get í•¨ìˆ˜ë“¤ì„ í†µí•´ ì›í•˜ëŠ” ê²°ê³¼ê°’ì€ ë‹¤ìŒê³¼ ê°™ë‹¤

<aside>
ğŸ“ **m_ContentDir**
C:\Users\imjub\Desktop\jjudy\CppPractice\assort51\WinAPI\OutputFile\content\

</aside>

<aside>
ğŸ“ **m_SolutionDir**
C:\Users\imjub\Desktop\jjudy\CppPractice\assort51\WinAPI

</aside>

<aside>
ğŸ“ **m_ProjDir**
C:\Users\imjub\Desktop\jjudy\CppPractice\assort51\WinAPI\GameClient

</aside>

1. Base ê²½ë¡œ ì–»ê¸° + ìƒìœ„ í´ë” ì´ë™ í•¨ìˆ˜ êµ¬í˜„
    
    â†’ ì²˜ìŒ GetCurrentDirectoryë¥¼ í†µí•´ ì–»ì„ ìˆ˜ ìˆëŠ” ê²½ë¡œëŠ”
    
    > C:\Users\imjub\Desktop\jjudy\CppPractice\assort51\WinAPI\OutputFile\bin
    > 
    
    ë”°ë¼ì„œ Contentë“ , Solutionì´ë“ , Projectë“  ëª¨ë“  ë””ë ‰í† ë¦¬ë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„ , í˜„ì¬ ê²½ë¡œì—ì„œ ìƒìœ„ ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•˜ë‹¤
    
    ê²½ë¡œ ë¬¸ìì—´ìƒìœ¼ë¡œ ìƒìœ„ ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€, ê°€ì¥ ë§ˆì§€ë§‰ì˜ ë””ë ‰í† ë¦¬ (í˜„ì¬ëŠ” `\bin`)ì„ ì˜ë¼ì£¼ë©´ ë˜ë¯€ë¡œ ë¬¸ìì—´ì„ í¸ì§‘í•´ ìƒìœ„ ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ”
    
    `GetParentPath()`ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜í•´ì¤€ë‹¤
    
    ```cpp
    void CPathMgr::GetParentPath(_Inout_ wchar_t* _Buffer)
    {
    	size_t len = wcslen(_Buffer);
    
    	for(int i = len - 1; 0 < i; --i)
    	{
    		if (L'\\' == _Buffer[i])
    		{
    			_Buffer[i] = L'\0';
    			break;
    		}
    	}
    }
    ```
    

1. Content ê²½ë¡œ ì„¤ì •í•˜ê¸°
    
    : `GetParentPath()`ë¥¼ í†µí•´ ì–»ì€ Base ê²½ë¡œì— ë¬¸ìì—´ì„ ë¶™ì—¬ contentê¹Œì§€ì˜ ê²½ë¡œë¥¼ ë¬¸ìì—´ë¡œ êµ¬í˜„
    
    ```cpp
    void CPathMgr::init()
    {
    	wchar_t szBuffer[256] = {};
    	GetCurrentDirectory(256, szBuffer);   // C:\...\WinAPI\OutputFile\bin
    	
    	// ìƒìœ„ í´ë”ë¡œ ì ‘ê·¼
    	GetParentPath(szBuffer);              // C:\...\WinAPI\OutputFile
    
    	// ì–»ì–´ë†“ì€ szBufferì— \\Content\\ë¥¼ ì¶”ê°€í•´ Content ê²½ë¡œ ë¬¸ìì—´ ì •ì˜
    	m_Content = szBuffer;
    	m_Content += L"\\content\\";          // C:\...\WinAPI\OutputFile\content\
    }
    
    ```
    

1. Solution ê²½ë¡œ ì„¤ì •í•˜ê¸°
    
    : `GetParentPath()`ë¥¼ í™œìš©í•´ Solution íŒŒì¼ì´ ìˆëŠ” ê²½ë¡œë¥¼ ë¬¸ìì—´ë¡œ êµ¬í˜„
    
    ```cpp
    void CPathMgr::init()
    {
    	// ...
    	// szBufferì— ì €ì¥ëœ ê²½ë¡œê°€ "C:\...\WinAPI\OutputFile" ì¸ ìƒíƒœ
    
    	// ìƒìœ„ í´ë”ë¡œ ì ‘ê·¼
    	GetParentPath(szBuffer);
    	m_Solution = szBuffer;                // C:\...\WinAPI
    }
    ```
    

1. Project ê²½ë¡œ ì„¤ì •í•˜ê¸°
    
    : í˜„ì¬ í”„ë¡œì íŠ¸ ì´ë¦„ì„ ë¦¬ì†ŒìŠ¤ì— ì €ì¥ë˜ì–´ ìˆëŠ” String tableì—ì„œ ê°€ì ¸ì˜¤ê³ , í”„ë¡œì íŠ¸ ì´ë¦„ì„ Solution ê²½ë¡œì— ë¶™ì—¬ Project ê²½ë¡œë¥¼ ë¬¸ìì—´ë¡œ êµ¬í˜„
    
    ì´ë•Œ, í”„ë¡œì íŠ¸ ì´ë¦„ì„ String tableì—ì„œ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ `LoadStringW`í•¨ìˆ˜ ì‚¬ìš©
    
    ```cpp
    int LoadStringW(
      [in, optional] HINSTANCE hInstance,
      [in]           UINT      uID,
      [out]          LPWSTR    lpBuffer,
      [in]           int       cchBufferMax
    );
    ```
    

ë˜ í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ì¸ `HINSTANCE`ê°€ í•„ìš”í•˜ê¸° ë•Œë¬¸ì—, CEngineì˜ initë¥¼ ì‚´ì§ ìˆ˜ì •í•´ hInstnaceì˜ getterë¥¼ ë§Œë“¤ì–´ ê°€ì ¸ì™€ì£¼ë„ë¡ í•˜ì

```cpp
class CEngine
{
	SINGLE(CEngine)
private:
	HINSTANCE m_hInstacne;
	// ...

public:
	int init(HINSTANCE _hInst, HWND _hWnd, POINT _Resolution);
	// ...

public:
	HINSTANCE GetProcessInstance() { return m_hInstance; }
}
```

ê·¸ëŸ¼ ì´ë ‡ê²Œ ì‚¬ìš© ê°€ëŠ¥!

```cpp
void CPathMgr::init()
{
	// ...
	// String Table ì—ì„œ í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì–»ì–´ì˜¨ë‹¤.
	wchar_t szProjName[50] = {};
	LoadStringW(CEngine::GetInst()->GetProcessInstance(), IDS_APP_TITLE, szProjName, 50);

	// Solution ê²½ë¡œì—ì„œ í”„ë¡œì íŠ¸ ì´ë¦„ì„ ë¶™ì¸ë‹¤
	m_Proj = m_Solution + L"\\" + szProjName;      // C:\...\WinAPI\GameProject
}
```

## contentë¥¼ ë¶ˆëŸ¬ì™€ Asset ê°ì²´ë¥¼ ë§Œë“¤ì–´ë³´ì

### Assetë¥¼ ë‹´ëŠ” í´ë˜ìŠ¤ CAsset ì •ì˜

CAssetì€ ì‹¤ì§ˆì ì¸ Assetì„ êµ¬í˜„í–ˆì„ ë•Œ í•´ë‹¹ Assetë“¤ì´ ê°€ì ¸ì•¼í•˜ëŠ” ê³µí†µì ì¸ ë¶€ë¶„ì„ êµ¬í˜„í•œ í´ë˜ìŠ¤ë¡œ, ì¶”ìƒí´ë˜ìŠ¤ì´ì ëª¨ë“  Assetì˜ ë¶€ëª¨ í´ë˜ìŠ¤ë¼ê³  í•  ìˆ˜ ìˆë‹¤

í˜„ì¬ ìƒí™©ì—ì„œëŠ” Texture, Sound í´ë˜ìŠ¤ê°€ í•´ë‹¹ CAssetì„ ìƒì†ë°›ì„ ê²ƒì´ë‹¤

```cpp
class CAsset
	: public CEntity
{
private:
	wstring m_Key;               // ë¡œë”©í•  ë•Œ ì‚¬ìš©í•œ í‚¤
	wstinrg m_RelativePath;      // ìƒëŒ€ ê²½ë¡œ (...\content\ë¶€í„°ì˜ ê²½ë¡œ)

public:
	const wstring& GetKey() { return m_Key; }
	const wstring& GetRelativePath() { return m_RelativePath; }
	virtual int Load(const wstring& _strFilePath) = 0;
public:
	CAsset();
	~CAsset();
}
```

- ìƒëŒ€ê²½ë¡œ : Content ê²½ë¡œë¶€í„° í•´ë‹¹ ì—ì…‹ì´ ê°€ì§€ê²Œ ë˜ëŠ” ìƒëŒ€ì ì¸ ê²½ë¡œ
- `virtual int Load(const wstring& _strFilePath) = 0;`
    - ìˆœìˆ˜ê°€ìƒí•¨ìˆ˜ë¡œì„œ *CAssetì„ ì¶”ìƒí™”í•˜ëŠ” ì—­í• *
    - Loadë¥¼ ìì‹ í´ë˜ìŠ¤ì—ê²Œ ë°˜ë“œì‹œ ìƒì†í•´ì•¼ í•˜ëŠ” í•¨ìˆ˜ë¡œ ì„¤ì •

### ì´ë¯¸ì§€ ì—ì…‹ì„ ë‹´ëŠ” CTextureì˜ ì„¤ê³„

```cpp
class CTexture:
	public CAsset
{
private:
	

public:
	// ë°˜ë“œì‹œ ì˜¤ë²„ë¼ì´ë”©í•´ì•¼ í•˜ëŠ” ìˆœìˆ˜ê°€ìƒí•¨ìˆ˜ Load ì¬ì •ì˜
	// Load : í…ìŠ¤ì²˜ë¥¼ íŒŒì¼ë¡œë¶€í„° ë¡œë“œí•´ì˜´
	virtual int Load(const wstring& _strFilePath) override;     
};
```

```cpp
int CTexture::Load(const wstring& _strFilePath) override
{

	return S_OK;
}
```

í…ìŠ¤ì²˜ë¥¼ íŒŒì¼ë¡œë¶€í„° ë¡œë“œí•´ì˜¨ë‹¤ëŠ” ê²ƒì€ ì–´ë–¤ ì˜ë¯¸ì¼ê¹Œ?

â†’ í•´ë‹¹ ë¡œë”©ì‹œí‚¤ë ¤ëŠ” ì´ë¯¸ì§€ ì‚¬ì´ì¦ˆë§Œí¼, í•´ë‹¹ ì´ë¯¸ì§€ì˜ í”½ì…€ ë°ì´í„° ì •ë³´ë¥¼ ìƒˆë¡œìš´ ë‚´ ë¹„íŠ¸ë§µì— ë³µì‚¬í•´ì˜¨ë‹¤!

ë”°ë¼ì„œ ë©¤ë²„ ë³€ìˆ˜ëŠ”

- ë¹„íŠ¸ë§µ (`HBITMAP  m_hBit`)
- DC (`HDC  m_hDC`)

```cpp
#pragma once
#include "CAsset.h"

class CTexture
	: public CAsset
{
private:
	HDC         m_hDC;
	HBITMAP     m_hBit;

public:
	virtual int Load(const wstring& _strFilePath) override;
}
```

TextureëŠ” ì´ë¯¸ì§€ íŒŒì¼ì„ ë¶ˆëŸ¬ì™€ì•¼ í•˜ë¯€ë¡œ, ë‚´ë¶€ì ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆëŠ” í•¨ìˆ˜ì¸`LoadImage()` í•¨ìˆ˜ë¥¼ í™œìš©í•´ Texture ì—ì…‹ì„ ìœ„í•œ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì‘ì—…ì„ virtual í•¨ìˆ˜ì¸ `Load`ì—ì„œ ì§„í–‰í•´ ì¤„ ê²ƒì´ë‹¤!

**LoadImage()ì˜ ì›í˜•**

```cpp
LoadImageW(
    _In_opt_ HINSTANCE hInst,        // ë¡œë“œí•  ì´ë¯¸ì§€ê°€ í¬í•¨ëœ íŒŒì¼ì˜ ëª¨ë“ˆ
    _In_ LPCWSTR name,               // ë¡œë“œí•  ì´ë¯¸ì§€ì˜ ì´ë¦„
    _In_ UINT type,                  // ë¡œë“œí•  ì´ë¯¸ì§€ì˜ í˜•ì‹
    _In_ int cx,                     // ë„ˆë¹„ í”½ì…€
    _In_ int cy,                     // ë†’ì´ í”½ì…€
    _In_ UINT fuLoad);               // ë Œë”ë§ ì˜µì…˜?ì— ëŒ€í•œ í”Œë˜ê·¸
```

```cpp
int CTexture::Load(const wstring& _strFilePath)
{
	m_hBit = (HBITMAP) LoadImage(nullptr, 
															_strFilePath.c_str(),
															IMAGE_BITMAP,
															0, 0,
															LR_LOADFROMFILE | LR_CREATEDIBSECTION);

		// Asset ë¡œë”©ì— ì‹¤íŒ¨í•´ ë¹„íŠ¸ë§µì„ ìƒì„±í•˜ì§€ ëª»í–ˆì„ ê²½ìš°ì˜ ì˜ˆì™¸ ì²˜ë¦¬
    if (nullptr == m_hBit)
    {
        MessageBox(nullptr, L"ë¹„íŠ¸ë§µ ë¡œë”© ì‹¤íŒ¨", L"Asset ë¡œë”© ì‹¤íŒ¨", MB_OK);
        return E_FAIL;
    }

	// ë¡œë“œëœ ë¹„íŠ¸ë§µ ì •ë³´ í™•ì¸
	GetObject(m_hBit, sizeof(BITMAP), &m_Info);

	// DCë¥¼ ìƒì„±ì‹œì¼œì„œ ë¡œë“œëœ ë¹„íŠ¸ë§µì´ë‘ ì—°ê²°í•œë‹¤
	m_hDC = CreateCompatibleDC(CEngine::GetInst()->GetMainDC());
	deleteObject(SelectObject(m_hDC, m_hBit));

	return S_OK;
}
```

- `_strFilePath.c_str()` : wstring ì„ `LPCWSTR`ë¡œ ë°”ê¾¸ë ¤ë©´ .c_str() ì‚¬ìš©

### + CEntityì˜ ìˆœìˆ˜ ê°€ìƒí•¨ìˆ˜ Cloneì— ëŒ€í•œ ì½”ë“œ ë¦¬íŒ©í† ë§

Cloneì„ ë§¤í¬ë¡œë¡œ ë§Œë“¤ì!

ê·¸ëŸ°ë° ì´ë•Œ, Cloneì„ ì˜¤ë²„ë¼ì´ë”©í•´ ì¬ì •ì˜ë¥¼ í•  ìˆ˜ë„ ìˆì§€ë§Œ, 

ì •ë§ ë‹¨ìˆœíˆ overrideì˜ ì˜ë¬´ë§Œ ìˆ˜í–‰í•˜ê³  ë³„ë‹¤ë¥¸ ê¸°ëŠ¥ì€ í•˜ì§€ ì•Šë„ë¡ ë§Œë“¤ê³  ì‹¶ì„ ìˆ˜ ìˆìœ¼ë‹ˆâ€¦

- ìˆœìˆ˜ ê°€ìƒí•¨ìˆ˜ë¥¼ overrideí•œ `CLONE`,
- ì¶”ìƒ í´ë˜ìŠ¤ë¥¼ ë²—ì–´ë‚˜ê¸° ìœ„í•´ overrideì˜ ì˜ë¬´ë§Œ ìˆ˜í–‰í•˜ê³ , êµ¬í˜„ì€ í•˜ì§€ ì•ŠëŠ” `CLONE_DISABLE`

ë¡œ ë‚˜ëˆ ì„œ êµ¬í˜„í•˜ì

```cpp
// ìˆœìˆ˜ ê°€ìƒí•¨ìˆ˜ë¥¼ ì˜¤ë²„ë¼ì´ë”©í•œ Cloneì˜ í˜•íƒœ
#define CLONE(Type) virtual Type* Clone() override {return new Type(*this)};

// ì¶”ìƒ í´ë˜ìŠ¤ë¥¼ ë²—ì–´ë‚˜ê¸° ìœ„í•´ overrideë¥¼ í•˜ê¸´í•˜ì§€ë§Œ.. êµ¬í˜„ì€ í•˜ì§€ ì•ŠëŠ” Cloneì˜ í˜•íƒœ
#define CLONE_DISABLE(Type) virtual Type* Clone() override { return nullptr };
```

> ë¦¬íŒ©í† ë§í•œ ì´ìœ !
> 

â†’ Assetì€ Clone ê¸°ëŠ¥ì´ í•„ìš” ì—†ë‹¤!

ë‹¨ í•˜ë‚˜ì˜ ê°ì²´ë§Œ ë§Œë“¤ì–´ì„œ, í•„ìš”í•  ë•Œ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ì‹ìœ¼ë¡œë§Œ ì‚¬ìš©í• ê±°ë‹ˆê¹Œ

ë”°ë¼ì„œ `CLONE_DISABLE` ë²„ì „ì„ Assetì—ì„œ ì˜¤ë²„ë¼ì´ë”© í•˜ë©´ Textureì™€ Soundì—ì„œëŠ” ì˜¤ë²„ë¼ì´ë”©í•  í•„ìš”ê°€ ì—†ì–´ì§„ë‹¤

```cpp
class CAsset
	: public CEntity
{
// ...
public:
	CLONE_DISABLE();
}
```

## Assetë“¤ì„ ê´€ë¦¬í•˜ëŠ” AssetMgr ì •ì˜

Assetë“¤ì€ ë‹¨ë…ìœ¼ë¡œ ì‚¬ìš©ë˜ì§€ ì•Šê³ , Assetë“¤ì„ ê´€ë¦¬í•´ì£¼ëŠ” *Assetì— ëŒ€í•œ ë§¤ë‹ˆì €*(`AssetMgr`)ë¥¼ í†µí•´ ë”°ë¡œ ê´€ë¦¬í•´ì¤„ ê²ƒì´ë‹¤

Assetë“¤ì€ AssetMgrì„ í†µí•´ì„œ 

- `Load`ë˜ì–´ contentì— ìˆëŠ” íŒŒì¼ê³¼ Assetì´ ë§¤ì¹­ë˜ê³ ,
- `Find` ë˜ì–´ ì ì¬ì ì†Œì— ì‚¬ìš©ì´ ë  ê²ƒì´ë‹¤!

ì´ë¥¼ ìœ„í•œ AssetMgrì˜ í‹€ì„ ì§œë³´ì

```cpp
#pragma once

class CTexture;

class CAssetMgr
{
	SINGLE(CAssetMgr);

private:
	CTexture* m_LoadTex;        // ë¶ˆëŸ¬ì˜¨ Texture

public:
	void init();

	CTexture* LoadTexture(const wstring& _Key, const wstring& _strRelativePath);
	CTexture* FindTexture(const wstring& _Key)
};
```

- `CTexture* LoadTexture(const wstring& _Key, const wstring& _strRelativePath)`
    
    : Texture ê°ì²´ë¥¼ ìƒì„±í•˜ë©°, í•´ë‹¹ ê°ì²´ì˜ Loadë¥¼ í†µí•´ ì´ë¯¸ì§€ ì—ì…‹ì„ ê°€ì ¸ì˜¤ê³ , í•´ë‹¹ ê°ì²´ë¥¼ ê´€ë¦¬ ëª©ë¡ì— ì¶”ê°€
    
    - ì¸ì 1 : ì¸ìë¡œ ë°›ì€ Keyê°’ì„ ê´€ë¦¬ëª©ë¡ì—ì„œ ì°¾ì•„ â­***ì´ë¯¸ ì¡´ì¬í•˜ëŠ” Textureì¸ì§€ ê²€ì‚¬***
    - ì¸ì 2 : contentë¡œë¶€í„°ì˜ ìƒëŒ€ì ì¸ ê²½ë¡œì— ëŒ€í•œ ì£¼ì†Œë¥¼ ë¬¸ìì—´ë¡œ ë°›ì•„ì˜´
- `CTexture* FindTexture(const wstring& _Key)`
    
    : ê´€ë¦¬ëª©ë¡ì—ì„œ ì›í•˜ëŠ” Texture ê°ì²´ë¥¼ ì°¾ìŒ
    
    - ì¸ì 1 : ì¸ìë¡œ ë°›ì€ Keyê°’ì„ í†µí•´ ê´€ë¦¬ëª©ë¡ì—ì„œ ì›í•˜ëŠ” Texture ê°ì²´ë¥¼ ê°€ì ¸ì˜´

ê·¸ëŸ¼ ê´€ë¦¬ ëª©ë¡ì— ì¶”ê°€í•˜ê³ , íƒìƒ‰í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆë‹¤ë©´ ì´ì— ìœ ë¦¬í•œ ìë£Œêµ¬ì¡°ì¸ ***map***ìœ¼ë¡œ ê°ê°ì˜ Assetë“¤ì„ ê´€ë¦¬í•´ì£¼ë©´ ë  ê²ƒì´ë‹¤!

```cpp
#pragma once

class CTexture;

class CAssetMgr
{
	SINGLE(CAssetMgr);

private:
	map<wstring, CTexture*> m_mapTex;
	map<wstring, CSound*> m_mapSound;

public:
	void init();

	CTexture* LoadTexture(const wstring& _Key, const wstring& _strRelativePath);
	CTexture* FindTexture(const wstring& _Key)
};
```

### Textureë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ”, LoadTexture êµ¬í˜„

ê·¸ëŸ¼ ë¨¼ì € **Textureë¥¼ Loadí•˜ëŠ” ê¸°ëŠ¥**ì— ëŒ€í•´ ë¨¼ì € êµ¬í˜„í•´ë³´ì

- ì´ë¯¸ ë“±ë¡ëœ ë©¤ë²„ ì¤‘, í˜„ì¬ ì¸ìë¡œ ë“¤ì–´ì˜¨ Keyë¡œ ë“±ë¡ëœ Textureê°€ ìˆëŠ”ì§€ ë¨¼ì € í™•ì¸

â†’ ì–´ì°¨í”¼ â€œ*í˜„ì¬ ì¸ìë¡œ ë“¤ì–´ì˜¨ Keyë¡œ ë“±ë¡ëœ Textureë¥¼ ì°¾ëŠ” ê¸°ëŠ¥â€*ì€ `FindTexture`ì™€ ë™ì¼í•˜ë‹ˆê¹Œ í˜¸ì¶œí•´ì„œ ëŒ€ì²´í•¨!

```cpp
CTexture* pTex = FindTexture(_Key);
if (pTex != nullptr)
{
	return pTex;
}
```

- Texture ê°ì²´ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ Fileì˜ ì „ì²´ ê²½ë¡œ ê°€ì ¸ì˜¤ê¸°

```cpp
wstring strFilePath = CPathMgr::GetInst()->GetContentPath();
strFilePath += _strRelativepath;
```

- Texture ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë¡œë”©í•˜ê¸°
    - ì´ë•Œ CTextureì˜ Load í•¨ìˆ˜ë¥¼ privateìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•œë‹¤
        
        : AssetMgrì—ì„œë§Œ ê´€ë¦¬í•˜ê³ , ì™¸ë¶€ì—ì„œëŠ” í˜¸ì¶œë˜ì§€ ì•Šë„ë¡
        
    - CTextureëŠ” ìì‹ ì˜ private ì˜ì—­ì— CAssetMgrì˜ ì ‘ê·¼ì„ í—ˆìš©í•˜ë„ë¡ friend ì„ ì–¸ì„ í•´ì¤˜ì•¼ í•œë‹¤

```cpp
pTex = new CTexture;
if (FAILED(pTex->Load(strFilePath)))
{
	MessageBox(nullptr, _strRelativePath.c_str(), L"í…ìŠ¤ì³ ë¡œë”© ì‹¤íŒ¨", MB_OK);
	delete pTex;

	return nullptr;
}
```

- mapì— ë¡œë”©ëœ Textureë¥¼ ë“±ë¡

```cpp
m_mapTex.insert(make_pair(_Key, pTex));
```

- ë“±ë¡ëœ Texture ì—ì…‹ì— ë³¸ì¸ì˜ í‚¤ ê°’ê³¼ ìƒëŒ€ ê²½ë¡œë¥¼ ì•Œë ¤ì¤Œ (ë¶€ëª¨ í´ë˜ìŠ¤ CAssetì˜ ë©¤ë²„ ë³€ìˆ˜)

```cpp
pTex->m_Key = _Key;                         
pTex->m_RelativePath = _strRelativePath;
```

ê·¸ëŸ¼ ì›í•˜ëŠ” Textureë¥¼ ê°€ì ¸ì˜¤ëŠ” ì‘ì—…ì€ ì´ë ‡ê²Œ ìˆ˜í–‰í•˜ë©´ ëœë‹¤!

ex) playerì˜ image ì„¤ì •ì„ ìœ„í•œ Texture Load ìˆ˜í–‰

```cpp
class CPlayer
	: public CObj
{
private:
	// ...
	CTexture* m_PlayerImg;

	// ...
}
```

```cpp
CPlayer::CPlayer()
{
	//...
	m_playerImg = CAssetMgr::GetInst()->LoadTexture(L"PlayerTex", L"texture\\Fighter.bmp");
}
```

### mapì—ì„œ Texturë¥¼ íƒìƒ‰í•˜ëŠ”, FindTexture êµ¬í˜„

`LoadTexture`ì—ì„œ ê°€ì¥ ë¨¼ì € FindTextureë¥¼ í†µí•´ í•´ë‹¹ keyë¡œ mapì— ì´ë¯¸ ë“±ë¡ëœ Texture ë©¤ë²„ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ì¤¬ë˜ ì´ìœ ëŠ”, mapì— ë“±ë¡í•  ë•Œì—ëŠ” keyê°€ ì¤‘ë³µë˜ë©´ ì•ˆë˜ê¸° ë•Œë¬¸ì´ë‹¤!

mapì— ì´ë¯¸ ë“±ë¡ëœ Textureë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆëŠ” findTexture í•¨ìˆ˜ë„ êµ¬í˜„í•´ì£¼ì

```cpp
CTextture* CAssetMgr::FindTexture(cosnt wstirng& _Key)
{
	map<wstring, CTexture*>::iterator iter = m_mapTex.find(_Key);

	if(iter == m_mapTex.end())
		return nullptr;

	return iter->second;
}
```

â†’ Keyê°€ ì¼ì¹˜í•˜ëŠ” ë©¤ë²„ë¥¼ ì°¾ì•˜ë‹¤ë©´ secondì— í•´ë‹¹í•˜ëŠ” Texture í¬ì¸í„°ë¥¼ ë°˜í™˜

### mapì— ëŒ€í•œ ì‚­ì œ ê¸°ëŠ¥ Safe_del_mapì„ í…œí”Œë¦¿ í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ì£¼ê¸°!

```cpp
template<typename T1, typename T2>
void Safe_Del_Map(map<T1, T2>& _map)
{
	for(const auto& pair : _map)
	{
		if(nullptr != pair.second)
			delete pair.second;
	}

	_map.clear();
}
```

### CAssetMgr í•œëˆˆì— ë³´ê¸°

CAssetMgr.h

```cpp
#pragma once

class CTexture;
class CSound;

class CAssetMgr
{
	SINGLE(CAssetMgr);

private:
	map<wstring, CTexture*>	m_mapTex;
	map<wstring, CSound*> m_mapSound;
	

public:
	void init();
	CTexture* LoadTexture(const wstring& _Key, const wstring& _strRelativePath);
	CTexture* FindTexture(const wstring& _Key);

};
```

CAssetMgr.cpp

```cpp
#include "pch.h"
#include "CAssetMgr.h"

#include "CPathMgr.h"
#include "CTexture.h"
#include "CSound.h"

CAssetMgr::CAssetMgr()
{
}

CAssetMgr::~CAssetMgr()
{
	Safe_Del_Map(m_mapTex);
	Safe_Del_Map(m_mapSound);
}

void CAssetMgr::init()
{
	
}

CTexture* CAssetMgr::LoadTexture(const wstring& _Key, const wstring& _strRelativePath)
{
	// ì´ë¯¸ í•´ë‹¹ í‚¤ë¡œ ë“±ë¡ëœ í…ìŠ¤ì³ê°€ ìˆìœ¼ë©°
	CTexture* pTex = FindTexture(_Key);
	if (nullptr != pTex)
	{
		return pTex;
	}

	// Full Path ë¡œ ë§Œë“¤ê¸°
	wstring strFilePath = CPathMgr::GetInst()->GetContehtPath();
	strFilePath += _strRelativePath;

	// í…ìŠ¤ì³ ê°ì²´ ìƒì„±
	// í…ìŠ¤ì³ ë¡œë”©
	pTex = new CTexture;
	if (FAILED(pTex->Load(strFilePath)))
	{
		MessageBox(nullptr, _strRelativePath.c_str(), L"í…ìŠ¤ì³ ë¡œë”© ì‹¤íŒ¨", MB_OK);
		delete pTex;

		return nullptr;
	}

	// map ì— ë¡œë”©ëœ í…ìŠ¤ì³ë¥¼ ë“±ë¡
	m_mapTex.insert(make_pair(_Key, pTex));

	// í…ìŠ¤ì³ ì—ì…‹ì— ë³¸ì¸ì˜ í‚¤ê°’ê³¼ ìƒëŒ€ê²½ë¡œë¥¼ ì•Œë ¤ì¤Œ
	pTex->m_Key = _Key;
	pTex->m_RelativePath = _strRelativePath;

	return pTex;
}

CTexture* CAssetMgr::FindTexture(const wstring& _Key)
{
	map<wstring, CTexture*>::iterator iter = m_mapTex.find(_Key);

	if (iter == m_mapTex.end())
		return nullptr;

	return iter->second;
}
```

## ì¶”ê°€í•œ Assetì€ ì–´ë–»ê²Œ í™”ë©´ì— ê·¸ë¦´ ìˆ˜ ìˆì„ê¹Œ?

`BitBlt` í™œìš©!

<aside>
âœï¸ `BitBlt` ì— ëŒ€í•´ ë‹¤ì‹œ í•œë²ˆ ì•Œì•„ë³´ê³  ê°€ì

: ë¹„íŠ¸ë§µ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ê±°ë‚˜ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜ ì¤‘ í•˜ë‚˜ë¡œ, í™”ë©´ì—ì„œ íŠ¹ì • ì˜ì—­ì˜ ë¹„íŠ¸ë§µ ë°ì´í„°ë¥¼ ë‹¤ë¥¸ ìœ„ì¹˜ë¡œ ë¸”ë¡ ì „ì†¡í•˜ëŠ”ë° ì‚¬ìš©ëœë‹¤!
ì¦‰, í˜„ì¬ ê·¸ë¦¬ë ¤ëŠ” DCì—, ë³µì‚¬í•´ì˜¤ëŠ” ì›ë³¸ì˜ DCì˜ ë¹„íŠ¸ë§µ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ëŠ” ê²ƒì´ë‹¤.

í•¨ìˆ˜ì˜ ì›í˜•ê³¼ ê°ê°ì˜ íŒŒë¼ë¯¸í„°ê°€ ì˜ë¯¸í•˜ëŠ” ë°”ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤!

```cpp
BOOL BitBlt(
  HDC   hdcDest,  // ë³µì‚¬ ëŒ€ìƒì˜ ë””ë°”ì´ìŠ¤ ì»¨í…ìŠ¤íŠ¸ í•¸ë“¤
  int   xDest,    // ëŒ€ìƒ ë””ë°”ì´ìŠ¤ ì»¨í…ìŠ¤íŠ¸ì˜ x ì¢Œí‘œ
  int   yDest,    // ëŒ€ìƒ ë””ë°”ì´ìŠ¤ ì»¨í…ìŠ¤íŠ¸ì˜ y ì¢Œí‘œ
  int   width,    // ë³µì‚¬ë˜ëŠ” ì˜ì—­ì˜ ë„ˆë¹„
  int   height,   // ë³µì‚¬ë˜ëŠ” ì˜ì—­ì˜ ë†’ì´
  HDC   hdcSrc,   // ë³µì‚¬ ì›ë³¸ì˜ ë””ë°”ì´ìŠ¤ ì»¨í…ìŠ¤íŠ¸ í•¸ë“¤
  int   xSrc,     // ì›ë³¸ ë””ë°”ì´ìŠ¤ ì»¨í…ìŠ¤íŠ¸ì˜ x ì¢Œí‘œ
  int   ySrc,     // ì›ë³¸ ë””ë°”ì´ìŠ¤ ì»¨í…ìŠ¤íŠ¸ì˜ y ì¢Œí‘œ
  DWORD dwRop     // ë Œë”ë§ ì˜µì…˜
);
```

</aside>

ì´ë¥¼ í™œìš©í•´ ì•„ê¹Œ ì¶”ê°€í–ˆë˜ Player Textureë¥¼ í™”ë©´ì— ê·¸ë ¤ë³´ì!

```cpp
void CPlayer::render()
{
	float fWidth = (float)m_PlayerImg -> GetWidth();
	float fHeight = (float)m_PlayerImg-> GetHeight();

	BitBlt(DC, vPos.x - fWidth / 2.f, vPos.y - fHeight/2.f, fWidth, fHeight, m_PlayerImg->GetDC(), 0, 0, SCRCOPY());
}
```